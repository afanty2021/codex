# 命令参考

<cite>
**本文档引用的文件**  
- [codex.js](file://codex-cli/bin/codex.js)
- [main.rs](file://codex-rs/cli/src/main.rs)
- [lib.rs](file://codex-rs/cli/src/lib.rs)
- [cli.rs](file://codex-rs/exec/src/cli.rs)
- [login.rs](file://codex-rs/cli/src/login.rs)
- [mcp_cmd.rs](file://codex-rs/cli/src/mcp_cmd.rs)
</cite>

## 目录
1. [简介](#简介)
2. [核心命令](#核心命令)
3. [配置与功能标志](#配置与功能标志)
4. [命令行参数与配置系统交互](#命令行参数与配置系统交互)

## 简介
`codex` 是一个功能强大的命令行接口（CLI），用于与Codex智能代理进行交互。该CLI支持多种子命令，允许用户以交互或非交互模式运行任务、管理登录状态、执行代码审查、管理MCP服务器等。本参考文档详细描述了所有子命令、选项、参数和标志，并解释了它们如何与内部配置系统交互。

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L48-L62)

## 核心命令
`codex` CLI 提供了多个子命令来执行不同的操作。每个子命令都有其特定的用途和选项。

### exec 命令
`exec` 命令用于以非交互方式运行Codex。它允许用户直接提交提示并获取结果，而无需进入交互式界面。

**语法**
```
codex exec [OPTIONS] [PROMPT]
```

**选项**
- `-m, --model <MODEL>`: 指定代理应使用的模型。
- `--oss`: 使用开源提供商。
- `-s, --sandbox <SANDBOX_MODE>`: 选择执行模型生成的shell命令时使用的沙箱策略。
- `-p, --profile <PROFILE>`: 指定配置文件中的默认选项。
- `--full-auto`: 启用低摩擦的沙箱自动执行模式。
- `--dangerously-bypass-approvals-and-sandbox`: 跳过所有确认提示并在无沙箱的情况下执行命令（极其危险）。
- `-C, --cd <DIR>`: 指定代理的工作根目录。
- `--skip-git-repo-check`: 允许在非Git仓库中运行Codex。
- `--add-dir <DIR>`: 指定除主工作区外的其他可写目录。
- `--output-schema <FILE>`: 指定描述模型最终响应形状的JSON模式文件路径。
- `--color <COLOR>`: 指定输出的颜色设置。
- `--json`: 以JSONL格式将事件打印到stdout。
- `-o, --output-last-message <FILE>`: 指定将代理最后一条消息写入的文件。
- `--prompt <PROMPT>`: 初始指令。如果未作为参数提供，则从stdin读取。

**示例**
```bash
# 运行一个简单的查询
codex exec "列出当前目录下的文件"

# 使用特定模型和沙箱模式
codex exec -m gpt-4 --sandbox workspace-write "创建一个Python脚本"

# 从stdin读取提示
echo "解释这段代码" | codex exec --prompt -
```

**Section sources**
- [cli.rs](file://codex-rs/exec/src/cli.rs#L6-L87)
- [main.rs](file://codex-rs/cli/src/main.rs#L79-L81)

### review 命令
`review` 命令用于对当前存储库中的更改进行代码审查。

**语法**
```
codex review [OPTIONS]
```

**选项**
- `--uncommitted`: 审查已暂存、未暂存和未跟踪的更改。
- `--base <BRANCH>`: 针对给定的基础分支审查更改。
- `--commit <SHA>`: 审查由提交引入的更改。
- `--title <TITLE>`: 在审查摘要中显示的可选提交标题。
- `--prompt <PROMPT>`: 自定义审查指令。

**示例**
```bash
# 审查未提交的更改
codex review --uncommitted

# 审查与主分支的差异
codex review --base main

# 审查特定提交
codex review --commit abc123 --title "添加新功能"
```

**Section sources**
- [cli.rs](file://codex-rs/exec/src/cli.rs#L116-L147)
- [main.rs](file://codex-rs/cli/src/main.rs#L83-L84)

### login 命令
`login` 命令用于管理登录状态。

**语法**
```
codex login [OPTIONS]
```

**选项**
- `--with-api-key`: 从stdin读取API密钥。
- `--device-auth`: 使用设备代码流程进行身份验证。
- `--experimental_issuer <URL>`: 使用自定义OAuth发行者基础URL（高级）。
- `--experimental_client-id <CLIENT_ID>`: 使用自定义OAuth客户端ID（高级）。

**子命令**
- `status`: 显示登录状态。

**示例**
```bash
# 使用API密钥登录
echo "your-api-key" | codex login --with-api-key

# 使用设备代码流程登录
codex login --device-auth

# 显示登录状态
codex login status
```

**Section sources**
- [login.rs](file://codex-rs/cli/src/login.rs#L18-L202)
- [main.rs](file://codex-rs/cli/src/main.rs#L86-L90)

### mcp 命令
`mcp` 命令用于作为MCP服务器运行Codex并管理MCP服务器。

**语法**
```
codex mcp [OPTIONS] <SUBCOMMAND>
```

**子命令**
- `list`: 列出配置的MCP服务器。
- `get`: 显示单个服务器的详细信息。
- `add`: 向`~/.codex/config.toml`添加服务器启动器条目。
- `remove`: 删除服务器条目。
- `login`: 使用OAuth对配置的MCP服务器进行身份验证。
- `logout`: 删除服务器的存储OAuth凭据。

**示例**
```bash
# 列出所有MCP服务器
codex mcp list

# 添加一个新的MCP服务器
codex mcp add my-tool -- my-command

# 获取特定服务器的信息
codex mcp get my-tool

# 删除服务器
codex mcp remove my-tool
```

**Section sources**
- [mcp_cmd.rs](file://codex-rs/cli/src/mcp_cmd.rs#L24-L33)
- [main.rs](file://codex-rs/cli/src/main.rs#L92-L93)

### 其他命令
- `resume`: 恢复之前的交互式会话。
- `cloud`: 浏览来自Codex Cloud的任务并在本地应用更改。
- `completion`: 生成shell补全脚本。
- `sandbox`: 在Codex提供的沙箱内运行命令。
- `apply`: 将Codex代理生成的最新差异作为`git apply`应用于本地工作树。

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L116-L121)

## 配置与功能标志
`codex` CLI 支持通过命令行参数和配置文件来覆盖默认配置。功能标志允许启用或禁用特定功能。

### 配置覆盖
使用 `-c` 标志可以覆盖配置值。例如：
```bash
codex -c model=gpt-4 exec "写一个快速排序算法"
```

### 功能标志
使用 `--enable` 和 `--disable` 标志可以启用或禁用功能。例如：
```bash
codex --enable web_search_request exec "搜索最新的AI新闻"
```

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L64-L68)
- [main.rs](file://codex-rs/cli/src/main.rs#L363-L394)

## 命令行参数与配置系统交互
命令行参数与内部配置系统通过 `clap` 库定义的结构进行交互。当用户运行 `codex` 命令时，参数被解析并传递给相应的处理函数。配置覆盖和功能标志被合并到全局配置中，确保所有子命令都能访问一致的配置状态。

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L435-L446)
- [main.rs](file://codex-rs/cli/src/main.rs#L648-L657)